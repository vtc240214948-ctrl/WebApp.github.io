<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>多語言代碼運行器</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2e86de;
      --secondary: #10ac84;
      --dark: #222f3e;
      --light: #333333;
      --terminal-bg: #f5f5f5;
      --terminal-text: #333333;
      --danger: #ee5a24;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: #ffffff;
      color: var(--light);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-content {
      flex: 1;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #000000;
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.8;
      color: #000000;
    }
    
    .login-section {
      background: rgba(0, 0, 0, 0.05);
      padding: 15px;
      border-radius: 8px;
      min-width: 200px;
    }
    
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .login-form input {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: white;
      color: #000000;
    }
    
    .login-form button {
      padding: 8px;
      border-radius: 4px;
      border: none;
      background: var(--primary);
      color: white;
      cursor: pointer;
    }
    
    .app-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 768px) {
      .app-container {
        grid-template-columns: 1fr;
      }
      
      header {
        flex-direction: column;
        gap: 20px;
      }
    }
    
    .panel {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .panel-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #000000;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    select, button {
      padding: 10px 15px;
      border-radius: 5px;
      border: none;
      background: var(--dark);
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    select {
      flex: 1;
    }
    
    button {
      background: var(--primary);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    button:hover {
      background: #1e6fc9;
      transform: translateY(-2px);
    }
    
    button.secondary {
      background: var(--secondary);
    }
    
    button.secondary:hover {
      background: #0d9c75;
    }
    
    button.danger {
      background: var(--danger);
    }
    
    button.danger:hover {
      background: #d35400;
    }
    
    .code-editor {
      width: 100%;
      height: 300px;
      background: #f8f8f8;
      color: #000000;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      resize: vertical;
      margin-bottom: 15px;
    }
    
    .terminal {
      background: var(--terminal-bg);
      color: var(--terminal-text);
      border-radius: 5px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      height: 300px;
      overflow-y: auto;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
      border: 1px solid #ddd;
    }
    
    .terminal-line {
      margin-bottom: 5px;
    }
    
    .terminal-prompt {
      color: #2e86de;
      font-weight: bold;
    }
    
    .terminal-command {
      color: #000000;
    }
    
    .terminal-output {
      color: var(--terminal-text);
    }
    
    .terminal-error {
      color: #ee5a24;
    }
    
    .language-info {
      margin-top: 15px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 5px;
      font-size: 0.9rem;
      color: #000000;
    }
    
    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      font-size: 0.9rem;
      opacity: 0.7;
      color: #000000;
    }
    
    i, .fa-icon {
      color: #000000;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <h1><i class="fas fa-code"></i> 多語言代碼運行器</h1>
        <p class="subtitle">在瀏覽器中編寫和運行多種程式語言代碼</p>
      </div>
      
      <div class="login-section">
        <div class="login-form">
          <input type="text" id="username" placeholder="使用者名稱">
          <input type="password" id="password" placeholder="密碼">
          <button id="login-btn"><i class="fas fa-sign-in-alt"></i> 登入</button>
        </div>
      </div>
    </header>
    
    <div class="app-container">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">代碼編輯器</div>
          <div class="language-indicator">語言: <span id="current-lang">Python</span></div>
        </div>
        
        <div class="controls">
          <select id="language-select">
            <option value="python">Python (Pyodide)</option>
            <option value="javascript">JavaScript</option>
            <option value="java">Java (模擬)</option>
            <option value="cpp">C++ (模擬)</option>
            <option value="csharp">C# (模擬)</option>
            <option value="ruby">Ruby (模擬)</option>
            <option value="go">Go (模擬)</option>
          </select>
          <button id="run-btn"><i class="fas fa-play"></i> 運行</button>
          <button class="secondary" id="clear-btn"><i class="fas fa-broom"></i> 清除</button>
        </div>
        
        <textarea id="code-editor" class="code-editor" placeholder="在這裡輸入您的代碼..."># Python示例代碼
print("Hello, World!")

def factorial(n):
    if n == 0:
        return 1
    else:
        return n * factorial(n-1)

print(f"5的階乘是: {factorial(5)}")</textarea>
        
        <div class="language-info">
          <p><strong>語言資訊:</strong> <span id="lang-info">Python是一種解釋型、面向物件的高階程式語言。</span></p>
        </div>
      </div>
      
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">終端模擬器</div>
          <div class="terminal-status">狀態: <span id="terminal-status">就緒</span></div>
        </div>
        
        <div class="terminal" id="terminal">
          <div class="terminal-line">
            <span class="terminal-prompt">user@coderunner:~$ </span>
            <span class="terminal-command">歡迎使用多語言代碼運行器</span>
          </div>
          <div class="terminal-line terminal-output">
            這是一個模擬的終端環境。
          </div>
          <div class="terminal-line terminal-output">
            選擇左側的程式語言並點擊"運行"按鈕執行程式碼。
          </div>
          <div class="terminal-line">
            <span class="terminal-prompt">user@coderunner:~$ </span>
            <span class="terminal-command" id="current-command">等待命令...</span>
          </div>
        </div>
        
        <div class="controls" style="margin-top: 15px;">
          <button class="secondary" id="new-terminal-btn"><i class="fas fa-plus"></i> 新建終端</button>
          <button class="danger" id="clear-terminal-btn"><i class="fas fa-trash"></i> 清除終端</button>
        </div>
      </div>
    </div>
    
    <footer>
      <p>多語言代碼運行器 &copy; 2023 - 一個完全在瀏覽器中執行的程式環境</p>
      <p>本應用使用開源技術構建，不侵犯任何版權</p>
    </footer>
  </div>

  <script>
    // 頁面元素
    const languageSelect = document.getElementById('language-select');
    const codeEditor = document.getElementById('code-editor');
    const runButton = document.getElementById('run-btn');
    const clearButton = document.getElementById('clear-btn');
    const terminal = document.getElementById('terminal');
    const currentLang = document.getElementById('current-lang');
    const langInfo = document.getElementById('lang-info');
    let currentCommand = document.getElementById('current-command');
    const terminalStatus = document.getElementById('terminal-status');
    const clearTerminalBtn = document.getElementById('clear-terminal-btn');
    const newTerminalBtn = document.getElementById('new-terminal-btn');
    const loginBtn = document.getElementById('login-btn');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    
    // 語言資訊
    const languageInfo = {
      python: "Python是一種解釋型、面向物件的高階程式語言。",
      javascript: "JavaScript是一種高階的、解釋型的程式語言，主要用於Web開發。",
      java: "Java是一種面向物件的、跨平台的程式語言。",
      cpp: "C++是一種通用的、面向物件的程式語言，是C語言的擴展。",
      csharp: "C#是一種現代的、面向物件的程式語言，由微軟開發。",
      ruby: "Ruby是一種動態的、面向物件的程式語言，注重簡潔和生產力。",
      go: "Go是一種靜態類型的、編譯型的程式語言，由Google開發。"
    };
    
    // 預設代碼示例
    const codeExamples = {
      python: `# Python示例代碼
print("Hello, World!")

def factorial(n):
    if n == 0:
        return 1
    else:
        return n * factorial(n-1)

print(f"5的階乘是: {factorial(5)}")`,
      
      javascript: `// JavaScript示例代碼
console.log("Hello, World!");

function factorial(n) {
  if (n === 0) {
    return 1;
  } else {
    return n * factorial(n - 1);
  }
}

console.log("5的階乘是: " + factorial(5));`,
      
      java: `// Java示例代碼
public class Main {
  public static void main(String[] args) {
    System.out.println("Hello, World!");
    System.out.println("5的階乘是: " + factorial(5));
  }
  
  public static int factorial(int n) {
    if (n == 0) {
      return 1;
    } else {
      return n * factorial(n - 1);
    }
  }
}`,
      
      cpp: `// C++示例代碼
#include <iostream>
using namespace std;

int factorial(int n) {
  if (n == 0) {
    return 1;
  } else {
    return n * factorial(n - 1);
  }
}

int main() {
  cout << "Hello, World!" << endl;
  cout << "5的階乘是: " << factorial(5) << endl;
  return 0;
}`,
      
      csharp: `// C#示例代碼
using System;

class Program {
  static int Factorial(int n) {
    if (n == 0) {
      return 1;
    } else {
      return n * Factorial(n - 1);
    }
  }
  
  static void Main() {
    Console.WriteLine("Hello, World!");
    Console.WriteLine("5的階乘是: " + Factorial(5));
  }
}`,
      
      ruby: `# Ruby示例代碼
puts "Hello, World!"

def factorial(n)
  if n == 0
    return 1
  else
    return n * factorial(n-1)
  end
end

puts "5的階乘是: #{factorial(5)}"`,
      
      go: `// Go示例代碼
package main

import "fmt"

func factorial(n int) int {
  if n == 0 {
    return 1
  }
  return n * factorial(n-1)
}

func main() {
  fmt.Println("Hello, World!")
  fmt.Printf("5的階乘是: %d\\n", factorial(5))
}`
    };
    
    // 初始化Pyodide
    let pyodideReady = false;
    let pyodide = null;
    
    (async () => {
      try {
        // 使用官方CDN載入Pyodide
        const script = document.createElement('script');
        script.src = "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js";
        document.head.appendChild(script);
        
        script.onload = async () => {
          pyodide = await loadPyodide();
          pyodideReady = true;
          console.log("Pyodide ready");
          terminalStatus.textContent = "Pyodide已載入";
          addTerminalOutput("Pyodide初始化完成，Python環境已就緒。");
        };
      } catch (error) {
        console.error("Pyodide載入失敗:", error);
        terminalStatus.textContent = "Pyodide載入失敗";
        addTerminalOutput("錯誤: Pyodide載入失敗，Python環境不可用。", "error");
      }
    })();
    
    // 語言選擇事件
    languageSelect.addEventListener('change', function() {
      const lang = this.value;
      currentLang.textContent = this.options[this.selectedIndex].text;
      langInfo.textContent = languageInfo[lang];
      codeEditor.value = codeExamples[lang];
    });
    
    // 運行按鈕事件
    runButton.addEventListener('click', async function() {
      const lang = languageSelect.value;
      const code = codeEditor.value;
      
      // 更新終端顯示
      currentCommand.textContent = `運行 ${lang} 代碼`;
      terminalStatus.textContent = "運行中...";
      
      // 添加終端輸出
      addTerminalOutput(`開始執行 ${lang} 代碼...`);
      
      try {
        if (lang === 'python') {
          if (!pyodideReady) {
            addTerminalOutput("錯誤: Pyodide尚未載入完成，請稍後再試。", "error");
            terminalStatus.textContent = "Pyodide未就緒";
            return;
          }
          
          // 執行Python代碼
          try {
            const result = await pyodide.runPythonAsync(`
import sys, io
_buf = io.StringIO()
sys.stdout = _buf
sys.stderr = _buf
try:
${code.split('\n').map(l => '    ' + l).join('\n')}
except Exception as e:
    import traceback
    traceback.print_exc()
_buf.getvalue()
`);
            addTerminalOutput(result);
            terminalStatus.textContent = "執行完成";
          } catch (e) {
            addTerminalOutput('錯誤: ' + e, "error");
            terminalStatus.textContent = "執行出錯";
          }
        } else if (lang === 'javascript') {
          // 執行JavaScript代碼
          try {
            const originalLog = console.log;
            let output = "";
            
            console.log = function(...args) {
              output += args.join(' ') + '\n';
            };
            
            eval(code);
            console.log = originalLog;
            
            addTerminalOutput(output || "代碼執行完成，無輸出。");
            terminalStatus.textContent = "執行完成";
          } catch (e) {
            addTerminalOutput('錯誤: ' + e, "error");
            terminalStatus.textContent = "執行出錯";
          }
        } else {
          // 對於其他語言，模擬執行
          addTerminalOutput(`[模擬執行] 開始編譯 ${lang} 代碼...`);
          
          // 模擬編譯過程
          setTimeout(() => {
            addTerminalOutput(`[模擬執行] ${lang} 代碼編譯成功。`);
            
            // 模擬執行過程
            setTimeout(() => {
              // 提取代碼中的輸出語句並模擬輸出
              const output = extractOutputFromCode(code, lang);
              addTerminalOutput(`[模擬執行] 程式輸出:\n${output}`);
              terminalStatus.textContent = "模擬執行完成";
            }, 1000);
          }, 1500);
        }
      } catch (err) {
        addTerminalOutput('致命錯誤: ' + err, "error");
        terminalStatus.textContent = "執行出錯";
      }
    });
    
    // 清除代碼按鈕
    clearButton.addEventListener('click', function() {
      codeEditor.value = "";
    });
    
    // 清除終端按鈕
    clearTerminalBtn.addEventListener('click', function() {
      terminal.innerHTML = `
        <div class="terminal-line">
          <span class="terminal-prompt">user@coderunner:~$ </span>
          <span class="terminal-command">終端已清除</span>
        </div>
        <div class="terminal-line">
          <span class="terminal-prompt">user@coderunner:~$ </span>
          <span class="terminal-command" id="current-command">等待命令...</span>
        </div>
      `;
      // 重新取得當前命令元素
      currentCommand = document.getElementById('current-command');
    });
    
    // 新建終端按鈕
    newTerminalBtn.addEventListener('click', function() {
      terminal.innerHTML = `
        <div class="terminal-line">
          <span class="terminal-prompt">user@coderunner:~$ </span>
          <span class="terminal-command">新建終端會話</span>
        </div>
        <div class="terminal-line terminal-output">
          這是一個模擬的終端環境。
        </div>
        <div class="terminal-line">
          <span class="terminal-prompt">user@coderunner:~$ </span>
          <span class="terminal-command" id="current-command">等待命令...</span>
        </div>
      `;
      // 重新取得當前命令元素
      currentCommand = document.getElementById('current-command');
      terminalStatus.textContent = "就緒";
    });
    
    // 登入按鈕事件
    loginBtn.addEventListener('click', function() {
      const username = usernameInput.value;
      const password = passwordInput.value;
      
      if (!username || !password) {
        addTerminalOutput("錯誤: 請輸入使用者名稱和密碼", "error");
        return;
      }
      
      // 模擬登入過程
      addTerminalOutput(`嘗試登入使用者: ${username}`);
      terminalStatus.textContent = "登入中...";
      
      setTimeout(() => {
        addTerminalOutput(`使用者 ${username} 登入成功`);
        terminalStatus.textContent = "已登入";
        
        // 更新終端提示符
        const promptElements = document.querySelectorAll('.terminal-prompt');
        promptElements.forEach(el => {
          el.textContent = `${username}@coderunner:~$ `;
        });
      }, 1500);
    });
    
    // 輔助函數：添加終端輸出
    function addTerminalOutput(text, type = "output") {
      const lines = text.split('\n');
      lines.forEach(line => {
        if (line.trim() !== '') {
          const lineElement = document.createElement('div');
          lineElement.className = `terminal-line terminal-${type}`;
          lineElement.textContent = line;
          terminal.appendChild(lineElement);
        }
      });
      
      // 添加新的提示符
      const promptElement = document.createElement('div');
      promptElement.className = 'terminal-line';
      promptElement.innerHTML = `
        <span class="terminal-prompt">user@coderunner:~$ </span>
        <span class="terminal-command" id="current-command">等待命令...</span>
      `;
      terminal.appendChild(promptElement);
      
      // 更新當前命令元素引用
      currentCommand = document.getElementById('current-command');
      
      // 滾動到底部
      terminal.scrollTop = terminal.scrollHeight;
    }
    
    // 輔助函數：從代碼中提取輸出（用於模擬執行）
    function extractOutputFromCode(code, lang) {
      // 簡單模擬輸出提取
      let output = "";
      
      if (lang === 'java') {
        // 提取Java的System.out.println
        const matches = code.match(/System\.out\.println\([^)]+\)/g);
        if (matches) {
          matches.forEach(match => {
            // 簡單提取引號內的內容
            const contentMatch = match.match(/System\.out\.println\(["']([^"']+)["']\)/);
            if (contentMatch) {
              output += contentMatch[1] + '\n';
            } else {
              // 提取變數輸出
              const varMatch = match.match(/System\.out\.println\(([^)]+)\)/);
              if (varMatch) {
                output += `[變數輸出: ${varMatch[1]}]\n`;
              }
            }
          });
        }
      } else if (lang === 'cpp') {
        // 提取C++的cout
        const matches = code.match(/cout\s*<<[^;]+;/g);
        if (matches) {
          matches.forEach(match => {
            // 簡單提取字符串
            const strMatch = match.match(/<<\s*"([^"]+)"/);
            if (strMatch) {
              output += strMatch[1] + '\n';
            } else {
              output += `[C++輸出: ${match}]\n`;
            }
          });
        }
      } else if (lang === 'csharp') {
        // 提取C#的Console.WriteLine
        const matches = code.match(/Console\.WriteLine\([^)]+\)/g);
        if (matches) {
          matches.forEach(match => {
            const contentMatch = match.match(/Console\.WriteLine\(["']([^"']+)["']\)/);
            if (contentMatch) {
              output += contentMatch[1] + '\n';
            } else {
              const varMatch = match.match(/Console\.WriteLine\(([^)]+)\)/);
              if (varMatch) {
                output += `[變數輸出: ${varMatch[1]}]\n`;
              }
            }
          });
        }
      } else if (lang === 'ruby') {
        // 提取Ruby的puts
        const matches = code.match(/puts\s+["'][^"']+["']/g);
        if (matches) {
          matches.forEach(match => {
            const contentMatch = match.match(/puts\s+["']([^"']+)["']/);
            if (contentMatch) {
              output += contentMatch[1] + '\n';
            }
          });
        }
      } else if (lang === 'go') {
        // 提取Go的fmt.Println
        const matches = code.match(/fmt\.Println\([^)]+\)/g);
        if (matches) {
          matches.forEach(match => {
            const contentMatch = match.match(/fmt\.Println\(["']([^"']+)["']\)/);
            if (contentMatch) {
              output += contentMatch[1] + '\n';
            } else {
              const varMatch = match.match(/fmt\.Println\(([^)]+)\)/);
              if (varMatch) {
                output += `[變數輸出: ${varMatch[1]}]\n`;
              }
            }
          });
        }
      }
      
      return output || "程式執行完成，但未檢測到輸出語句。";
    }
    
    // 初始載入完成後的提示
    window.addEventListener('load', function() {
      addTerminalOutput("系統初始化完成，準備就緒。");
    });
  </script>
</body>
</html>
